# [PackageDev] target_format: plist, ext: tmLanguage
---
name: TaskJuggler
scopeName: source.tjp3
fileTypes: [tjp3]
# Arbitrary UUID, until I figure out where this is used.
uuid: 24341012-fbff-4468-926e-348ed6563de2

macros:
  ID: (?:\b[a-zA-Z_][a-zA-Z0-9_]*\b)
  stringDoubleQuoted: \"(?:[^\"\\]|\\.)+\"
  stringSingleQuoted: \'(?:[^\'\\]|\\.)+\'
  stringSingleLine: (?:{{stringDoubleQuoted}}|{{stringSingleQuoted}})
  endOfListAttribute: (?:(?<![,\s])\s*$)

patterns:
- include: '#account'

repository:
  account:
    patterns:
    # Order matters: Multi-line pattern must preceded the single line version.
    - begin: '^\s*(account)\s+(?:({{ID}})\s+)?({{stringSingleLine}})\s*\{'
      end: '\}'
      beginCaptures:
        '1': { name: storage.type.account.tjp3 }
        '2': { name: entity.name.type.account.tjp3 }
        '3': { name: string.quoted.tjp3 }
      patterns:
        - include: '#string'
        - begin: '^\s*(flags)\b'
          end: '{{endOfListAttribute}}'
          beginCaptures:
            '1': { name: storage.type.flags.tjp3 }
          patterns:
            - include: '#string'
            - match: '({{ID}})'
              captures:
                '1': { name: entity.name.type.flags.tjp3 }
    - match: '^\s*(account)\s+(?:({{ID}})\s+)?({{stringSingleLine}})'
      captures:
        '1': { name: storage.type.account.tjp3 }
        '2': { name: entity.name.type.account.tjp3 }
        '3': { name: string.quoted.tjp3 }
  string:
    patterns:
      - name: string.quoted.tjp3
        match: '{{stringSingleLine}}'